import numpy as np
from scipy.stats import ttest_ind
import matplotlib.pyplot as plt


# 한글 폰트 설정
plt.rc('font', family='Malgun Gothic')  # Windows
# plt.rc('font', family='AppleGothic')  # macOS
plt.rc('axes', unicode_minus=False)

# 데이터 생성 (공장 A와 B에서 추출한 부품 길이)
np.random.seed(42)
factory_a_lengths = np.random.normal(loc=50.5, scale=0.5, size=30)  # 공장 A: 평균 50.5, 표준편차 0.5
factory_b_lengths = np.random.normal(loc=50.7, scale=0.5, size=30)  # 공장 B: 평균 50.7, 표준편차 0.5

# t-검정 수행
t_stat, p_value = ttest_ind(factory_a_lengths, factory_b_lengths)

# 결과 출력
print(f"t-statistic: {t_stat:.3f}, p-value: {p_value:.3f}")

if p_value < 0.05:
    print("두 공장의 부품 평균 길이에 통계적으로 유의미한 차이가 있습니다.")
else:
    print("두 공장의 부품 평균 길이 차이가 통계적으로 유의미하지 않습니다.")

# 데이터 시각화
plt.boxplot([factory_a_lengths, factory_b_lengths], labels=["Factory A", "Factory B"])
plt.title("Comparison of Part Lengths by Factory")
plt.ylabel("Part Length (mm)")
plt.grid()
plt.show()

"""
========== 연습 문제 ==========

두 개의 공장에서 생산되는 부품의 길이를 비교하기 위해 독립표본 t검정을 수행하는 코드입니다.
공장 A와 공장 B에서 각각 30개의 부품을 샘플로 추출하여 길이를 측정했습니다.

문제 1: 독립표본 t검정과 단일표본 t검정의 차이점을 설명하세요.
   - 언제 독립표본 t검정을 사용하는지 구체적인 상황을 제시하세요.
   - 독립표본 t검정의 기본 가정들을 나열하세요.

문제 2: 이 예제에서의 귀무가설과 대립가설을 명확히 설정하세요.
   - 귀무가설(H₀): 
   - 대립가설(H₁): 
   - 이것이 양측검정인지 단측검정인지 판단하고 이유를 설명하세요.

문제 3: 코드 실행 결과를 분석해보세요:
   - t-통계량의 값과 의미를 해석하세요.
   - p-value가 0.05보다 크거나 작은 경우 각각의 결론을 설명하세요.
   - 자유도는 몇 개인지 계산하고 그 이유를 설명하세요.

문제 4: 독립표본 t검정의 가정들을 검증해보세요:
   a) 정규성 검정: Shapiro-Wilk 검정을 사용하여 각 그룹의 정규성을 확인하세요.
   b) 등분산성 검정: Levene 검정을 사용하여 두 그룹의 분산이 같은지 확인하세요.
   c) 만약 등분산 가정이 위배된다면 어떤 방법을 사용해야 하는지 설명하세요.

문제 5: 다음 상황들에 대해 코드를 수정하여 분석해보세요:
   a) 공장 A의 샘플 크기를 20개, 공장 B를 40개로 변경했을 때의 결과
   b) 공장 B의 평균을 50.5로 변경하여 두 공장의 평균이 같을 때의 결과
   c) 표준편차를 0.3으로 줄였을 때의 결과 변화
   d) 유의수준을 0.01로 변경했을 때의 결론 변화

문제 6: 효과크기(Effect Size)를 계산해보세요:
   - Cohen's d를 계산하여 두 그룹 간의 실질적 차이의 크기를 평가하세요.
   - Cohen's d의 해석 기준(작은 효과, 중간 효과, 큰 효과)을 적용하세요.

문제 7: 통계적 검정력(Statistical Power)에 대해 설명하세요:
   - 검정력이란 무엇인지 정의하세요.
   - 샘플 크기가 검정력에 미치는 영향을 설명하세요.
   - power_ttest_ind 함수를 사용하여 이 실험의 검정력을 계산해보세요.

문제 8: 시각화를 개선해보세요:
   a) 히스토그램을 추가하여 각 그룹의 분포를 보여주세요.
   b) 평균과 표준편차를 그래프에 표시하세요.
   c) 바이올린 플롯(violin plot)으로 데이터의 분포를 더 자세히 보여주세요.

문제 9: 비모수 검정과의 비교:
   - 만약 정규성 가정이 위배된다면 어떤 비모수 검정을 사용할 수 있는지 설명하세요.
   - Mann-Whitney U 검정을 수행하여 결과를 비교해보세요.

문제 10: 실제 응용 사례를 만들어보세요:
   a) 의학 분야: 두 치료법의 효과 비교
   b) 교육 분야: 두 교육 방법의 성적 비교  
   c) 마케팅 분야: 두 광고 전략의 효과 비교
   각 사례에 대해 가상의 데이터를 생성하고 독립표본 t검정을 수행하세요.

문제 11: 신뢰구간을 계산하세요:
   - 두 그룹 평균의 차이에 대한 95% 신뢰구간을 계산하세요.
   - 이 신뢰구간이 0을 포함하는지 확인하고 그 의미를 해석하세요.

문제 12: 대응표본 t검정과 비교하세요:
   - 동일한 30명의 작업자가 공장 A와 B에서 각각 작업했다고 가정하고
   - 대응표본 t검정을 수행하여 결과를 독립표본 t검정과 비교해보세요.
   - 어떤 경우에 대응표본 t검정이 더 적절한지 설명하세요.

=============================
"""
